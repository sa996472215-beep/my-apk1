<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ°ÙƒÙŠØ±</title>

<style>
:root{
  --bg:linear-gradient(135deg,#667eea,#764ba2);
  --card:#ffffff;
  --text:#000;
  --accent:#4CAF50;
}
.dark{
  --bg:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  --card:#1e1e1e;
  --text:#fff;
}

body{
  margin:0;
  font-family:Arial;
  background:var(--bg);
  color:var(--text);
  direction:rtl;
  min-height:100vh;
}

.topbar{
  background:rgba(0,0,0,.25);
  color:white;
  padding:12px;
  text-align:center;
  font-size:18px;
  position:sticky;
  top:0;
}

.toggle{
  position:absolute;
  left:12px;
  top:8px;
  background:#000;
  border:none;
  width:36px;
  height:36px;
  border-radius:50%;
  color:#fff;
  cursor:pointer;
}

.container{
  max-width:420px;
  margin:20px auto;
  background:var(--card);
  padding:20px;
  border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.4);
}

.field{
  margin-bottom:12px;
}

.field label{
  display:block;
  font-size:14px;
  margin-bottom:4px;
}

input,textarea,select,button{
  width:100%;
  margin:0;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
}

button{
  background:var(--accent);
  color:white;
  cursor:pointer;
  transition:.3s;
  margin-top:8px;
}
button:hover{transform:scale(1.03)}

.record{background:#2196F3}

.item{
  background:rgba(0,0,0,.05);
  padding:12px;
  border-radius:12px;
  margin-top:10px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}

.dark .item{background:rgba(255,255,255,.08)}

.delete{
  background:red;
  border:none;
  padding:6px;
  color:white;
  border-radius:8px;
  margin-left:8px;
}

.circle{
  width:50px;
  height:50px;
  border-radius:50%;
  background:conic-gradient(#4CAF50 var(--p), #ddd 0);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:11px;
}
</style>
</head>

<body>

<div class="topbar">
  â° Reminder App
  <button class="toggle" id="modeBtn" onclick="toggleMode()">ğŸŒ™</button>
</div>

<div class="container">

  <div class="field">
    <label>ğŸ“Œ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¹Ø¯</label>
    <input id="title" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¹Ø¯">
  </div>

  <div class="field">
    <label>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
    <input type="date" id="date">
  </div>

  <div class="field">
    <label>â° Ø§Ù„ÙˆÙ‚Øª</label>
    <input type="time" id="time">
  </div>

  <div class="field">
    <label>ğŸ” Ø§Ù„ØªÙƒØ±Ø§Ø±</label>
    <select id="repeat">
      <option value="none">Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø±</option>
      <option value="daily">ÙŠÙˆÙ…ÙŠ</option>
      <option value="weekly">Ø£Ø³Ø¨ÙˆØ¹ÙŠ</option>
    </select>
  </div>

  <div class="field">
    <label>ğŸµ Ù†ØºÙ…Ø© Ø§Ù„Ù…Ù†Ø¨Ù‡</label>
    <input type="file" id="sound" accept="audio/*">
  </div>

  <button class="record" onclick="toggleRecord()">ğŸ™ ØªØ³Ø¬ÙŠÙ„ ØµÙˆØª</button>

  <div class="field">
    <label>ğŸ“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
    <textarea id="note" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§"></textarea>
  </div>

  <button onclick="addReminder()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¹Ø¯</button>

  <div id="list"></div>
</div>

<script>
let reminders = JSON.parse(localStorage.getItem("reminders")) || [];
let mode = localStorage.getItem("mode");
const modeBtn=document.getElementById("modeBtn");

if(mode==="dark"){document.body.classList.add("dark"); modeBtn.textContent="â˜€";}

// Ø·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
if("Notification" in window && Notification.permission!=="granted"){
  Notification.requestPermission();
}

function toggleMode(){
  document.body.classList.toggle("dark");
  let dark=document.body.classList.contains("dark");
  modeBtn.textContent = dark ? "â˜€" : "ğŸŒ™";
  localStorage.setItem("mode", dark?"dark":"light");
}

const title=document.getElementById("title");
const dateInput=document.getElementById("date");
const timeInput=document.getElementById("time");
const noteInput=document.getElementById("note");
const sound=document.getElementById("sound");
const list=document.getElementById("list");
const repeat=document.getElementById("repeat");

let recorder,chunks=[],recordedAudio=null,recording=false;

async function toggleRecord(){
  if(!recording){
    let stream = await navigator.mediaDevices.getUserMedia({audio:true});
    recorder = new MediaRecorder(stream);
    recorder.start();
    chunks=[];
    recorder.ondataavailable=e=>chunks.push(e.data);
    recording=true;
    event.target.innerText="â¹ Ø¥ÙŠÙ‚Ø§Ù";
  }else{
    recorder.stop();
    recorder.onstop=()=>{
      let blob=new Blob(chunks,{type:"audio/webm"});
      let reader=new FileReader();
      reader.onload=()=>recordedAudio=reader.result;
      reader.readAsDataURL(blob);
    };
    recording=false;
    event.target.innerText="ğŸ™ ØªØ³Ø¬ÙŠÙ„ ØµÙˆØª";
  }
}

function addReminder(){
  if(!title.value||!dateInput.value||!timeInput.value)
    return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

  let fullTime = dateInput.value+"T"+timeInput.value;
  let file = sound.files[0];
  let reader = new FileReader();

  reader.onload = () => {
    let audioData = recordedAudio || reader.result;

    reminders.push({
      title:title.value,
      time:fullTime,
      note:noteInput.value,
      sound:audioData,
      repeat:repeat.value,
      done:false
    });

    localStorage.setItem("reminders",JSON.stringify(reminders));
    show();

    // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª ÙÙˆØ± Ø§Ù„Ø¥Ø¶Ø§ÙØ©
    if(audioData){ new Audio(audioData).play(); }

    // Ø¥Ø´Ø¹Ø§Ø± ÙÙˆØ± Ø§Ù„Ø¥Ø¶Ø§ÙØ©
    if("Notification" in window && Notification.permission==="granted"){
      new Notification("ğŸ“Œ ØªØ°ÙƒÙŠØ± Ø¬Ø¯ÙŠØ¯",{
        body: title.value + " ÙÙŠ " + timeInput.value,
        icon: "https://cdn-icons-png.flaticon.com/512/2910/2910762.png"
      });
    }

    // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
    title.value=dateInput.value=timeInput.value=noteInput.value="";
    sound.value="";
    recordedAudio=null;
  };

  if(file) reader.readAsDataURL(file);
  else reader.onload();
}

function show(){
  list.innerHTML="";
  const now = new Date();

  reminders.forEach((r,i)=>{
    const target = new Date(r.time);
    const total = target - now;
    const p = Math.max(0,Math.min(100,(total/3600000)*100)); // Ù†Ø³Ø¨Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø³Ø§Ø¹Ø©

    // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±
    if(!r.done && now >= target){
      r.done = true;
      if(r.sound) new Audio(r.sound).play();
      if("Notification" in window && Notification.permission==="granted"){
        new Notification("â° "+r.title,{
          body:"Ù…ÙˆØ¹Ø¯Ùƒ Ø§Ù„Ø¢Ù†!",
          icon:"https://cdn-icons-png.flaticon.com/512/2910/2910762.png"
        });
      }
      // ØªÙƒØ±Ø§Ø±
      if(r.repeat!=="none"){
        let next = new Date(target);
        if(r.repeat==="daily") next.setDate(next.getDate()+1);
        if(r.repeat==="weekly") next.setDate(next.getDate()+7);
        r.time = next.toISOString().slice(0,16);
        r.done = false;
      }
      localStorage.setItem("reminders",JSON.stringify(reminders));
    }

    list.innerHTML+=`
      <div class="item">
        <div>
          <b>ğŸ“Œ ${r.title}</b><br>
          â° ${target.toLocaleString("ar")}<br>
          ğŸ“ ${r.note||""}
        </div>
        <div class="circle" style="--p:${p}%">${Math.floor(p)}%</div>
        <button class="delete" onclick="del(${i})">Ø­Ø°Ù</button>
      </div>`;
  });
}

function del(i){
  reminders.splice(i,1);
  localStorage.setItem("reminders",JSON.stringify(reminders));
  show();
}

setInterval(show,1000);
show();
</script>

</body>
</html>